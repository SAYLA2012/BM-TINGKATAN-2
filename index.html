<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPM BM 2 AD DARIMI - CIKGU SUHAILA</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --pastel-yellow: #fef9c3;
            --light-yellow: #fefce8;
            --black-main: #1a1a1a;
            --black-muted: #404040;
            --white: #ffffff;
            --success: #059669;
            --danger: #dc2626;
            --border-color: #e5e7eb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body { background-color: var(--pastel-yellow); color: var(--black-main); min-height: 100vh; padding-bottom: 80px; }

        header { padding: 3rem 1rem; text-align: center; background: var(--black-main); color: var(--pastel-yellow); border-bottom: 8px solid #fbbf24; }
        header h1 { font-size: 2.2rem; font-weight: 800; letter-spacing: -0.5px; }
        header p { font-size: 0.9rem; opacity: 0.8; margin-top: 8px; font-weight: 500; text-transform: uppercase; letter-spacing: 2px; }

        .nav-tabs { display: flex; justify-content: center; gap: 5px; background: var(--white); position: sticky; top: 0; z-index: 100; padding: 0.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .tab-btn { padding: 0.8rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 700; color: var(--black-muted); font-size: 0.8rem; border-radius: 8px; transition: 0.3s; }
        .tab-btn:hover { background: var(--light-yellow); color: var(--black-main); }
        .tab-btn.active { color: var(--white); background: var(--black-main); }

        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--white); padding: 2rem; border-radius: 20px; border: 2px solid var(--black-main); box-shadow: 8px 8px 0px var(--black-main); }
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem; }
        .toolbar h2 { font-weight: 800; color: var(--black-main); text-transform: uppercase; font-size: 1.2rem; }

        .btn-bulk { background: var(--black-main); color: var(--pastel-yellow); border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.85rem; display: flex; align-items: center; gap: 10px; transition: 0.3s; }
        .btn-bulk:hover { transform: translate(-2px, -2px); box-shadow: 4px 4px 0px #fbbf24; }

        .table-wrapper { overflow-x: auto; border-radius: 12px; border: 1px solid var(--black-main); }
        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: var(--light-yellow); padding: 15px; text-align: left; font-size: 0.75rem; text-transform: uppercase; color: var(--black-main); font-weight: 800; border-bottom: 2px solid var(--black-main); }
        td { padding: 14px; border-bottom: 1px solid var(--border-color); font-size: 0.9rem; }
        
        input[type="date"], select { padding: 8px 12px; border: 1px solid var(--black-main); border-radius: 8px; outline: none; background: var(--light-yellow); font-weight: 600; font-size: 0.85rem; }
        select.status-hantar { background: #d1fae5; color: var(--success); }
        select.status-belum { background: #fee2e2; color: var(--danger); }
        .unit-cell { padding: 8px; border-radius: 8px; background: var(--light-yellow); border: 1px dashed var(--black-main); min-height: 38px; }

        /* Modal Papar Nama */
        #report-modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); z-index: 10001; 
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content { 
            background: white; width: 100%; max-width: 500px; border-radius: 24px; 
            border: 3px solid var(--black-main); box-shadow: 12px 12px 0px var(--black-main); 
            padding: 2rem; position: relative; animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .modal-header { text-align: center; margin-bottom: 1.5rem; }
        .modal-header i { font-size: 3rem; color: var(--success); margin-bottom: 10px; }
        .modal-header h3 { font-weight: 800; text-transform: uppercase; }
        
        .name-list { max-height: 300px; overflow-y: auto; background: var(--light-yellow); border-radius: 12px; padding: 15px; border: 1px solid var(--border-color); }
        .name-item { padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05); font-weight: 600; font-size: 0.85rem; display: flex; align-items: center; gap: 10px; }
        .name-item i { color: var(--success); font-size: 0.7rem; }
        
        .btn-close { width: 100%; margin-top: 1.5rem; background: var(--black-main); color: var(--pastel-yellow); padding: 12px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; }

        #loading-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(26, 26, 26, 0.95); z-index: 9999; color: var(--pastel-yellow); justify-content: center; align-items: center; flex-direction: column; }
        .loader { border: 5px solid var(--black-muted); border-top: 5px solid var(--pastel-yellow); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div id="loading-overlay">
    <div class="loader"></div>
    <p style="margin-top: 20px; font-weight: 700;">MENGHANTAR DATA KE GOOGLE SHEETS...</p>
</div>

<div id="report-modal">
    <div class="modal-content">
        <div class="modal-header">
            <i class="fa-solid fa-circle-check"></i>
            <h3>Berjaya Disimpan!</h3>
            <p id="summary-text" style="font-size: 0.85rem; font-weight: 600;"></p>
        </div>
        <p style="font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 8px; color: var(--black-muted);">Senarai Murid Hantar:</p>
        <div class="name-list" id="hantar-names">
            </div>
        <button class="btn-close" onclick="closeModal()">TUTUP & KEMBALI</button>
    </div>
</div>

<header>
    <h1>RPM BM 2 AD DARIMI TAHUN 2026</h1>
    <p>Cikgu Suhaila</p>
</header>

<nav class="nav-tabs">
    <button class="tab-btn active" onclick="showTab('mendengar')">MENDENGAR</button>
    <button class="tab-btn" onclick="showTab('membaca')">MEMBACA</button>
    <button class="tab-btn" onclick="showTab('menulis')">MENULIS</button>
    <button class="tab-btn" onclick="showTab('seni')">SENI BAHASA</button>
    <button class="tab-btn" onclick="showTab('tatabahasa')">TATABAHASA</button>
</nav>

<div class="container" id="main-container"></div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwciq5ZXkKdCGF6bgMChyuWK2N-jBVdDO-snQl0wjFTy_Z2fPACUus1MrdCYkHBb-ponQ/exec";
    
    const senaraiNama = ["ADAM MUHAMMAD ARIF BIN ABDUL HAKIM", "AHMAD AZIM MUTTAQIN BIN MOHD FAZIL", "AQIL HAIKAL BIN KHARUL AZLI", "ASHRAFF IZZQIEL BIN SAIPUL ANWAR NASUTION", "DIANA SHAFITRI BINTI AMIR", "MUHAIMIN FARIS ZAKIR BIN MOHD ZAIRI", "MUHAMMAD AATIF ZAYYAD BIN AMIRUDDIN", "MUHAMMAD ADAM ZAQUAN BIN MOHD SUKRI", "MUHAMMAD AIZUDDIN ADHA BIN AZMAN", "MUHAMMAD ASYRAFF SYAHIRAN BIN MOHD RIDUWAN", "MUHAMMAD AZRIN HAKEM BIN SUHAIMI", "MUHAMMAD NORHADI BIN NOOR MALHAFIZ", "MUHAMMAD SHAMSUL AMIRUL DANISH BIN MOHD SHAIFUL BAHRI", "MUHAMMAD UKASYAH ZARQASYI BIN AZIWA", "MUHAMMAD ZAFRAN QAYYIM BIN SUHAIRI", "NAJWA NAJEHA BINTI MUHAMMAD AMIRUL", "NOOR ARINA ADHWA BINTI NOAZMI", "NOR ALIYA NATASYA BINTI ABDUL MALIK", "NORFARZANA BINTI ABU BAKAR", "NUR AMIRAH BATRISYIA BINTI MOHD HAFIZAN", "NUR AULIA HAZIRA BINTI MOHD NORHASLAN", "NUR DAMIA QAISARA BINTI RAZZIS", "NUR DELISHA SAMEERA BINTI HASAN BASRI", "NUR HIDAYAH SOFIA BINTI AZMI", "NUR LIYANA SOFIA BINTI SAIFUL BAHARI", "NUR NADHIRAH BINTI MOHAMAD KHIR JOHARI", "NUR QHAIREEN AISYAH BINTI AL-MUSTAQIM BILLAH", "PUTERI ABABIL BT ABDULLAH", "PUTERI NURELESHA BINTI AZUWAN", "SITI NORFARISHA DANIA BINTI MUHAMMAD FIRDAUS", "ZARA IRDINA BINTI MOHD ASRULNIZAM", "ZULFAQAR BIN ZULKIFLI", "ZULFIQAR BIN ZULKIFLI"];
    
    const tabs = ['mendengar', 'membaca', 'menulis', 'seni', 'tatabahasa'];

    tabs.forEach(tabId => {
        document.getElementById('main-container').innerHTML += `
            <div id="${tabId}" class="tab-content ${tabId === 'mendengar' ? 'active' : ''}">
                <div class="card">
                    <div class="toolbar">
                        <h2>KEMAHIRAN ${tabId.toUpperCase()}</h2>
                        <button class="btn-bulk" onclick="saveAndReset('${tabId}')">
                            <i class="fa-solid fa-cloud-arrow-up"></i> SIMPAN & PAPAR NAMA
                        </button>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th style="text-align:center; width:50px;">Bil</th>
                                    <th>Nama Murid</th>
                                    <th style="width:180px;">Tarikh Pentaksiran</th>
                                    <th style="width:200px;">Unit/Topik</th>
                                    <th style="width:160px;">Status</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-${tabId}"></tbody>
                        </table>
                    </div>
                </div>
            </div>`;
        const tbody = document.getElementById(`tbody-${tabId}`);
        const today = new Date().toISOString().split('T')[0];
        senaraiNama.forEach((nama, i) => {
            tbody.innerHTML += `
                <tr>
                    <td style="text-align:center; font-weight:700;">${i+1}</td>
                    <td class="nama-cell" style="font-weight:700;">${nama}</td>
                    <td><input type="date" value="${today}"></td>
                    <td><div contenteditable="true" class="unit-cell">-</div></td>
                    <td>
                        <select onchange="this.className='status-'+this.value.toLowerCase()" class="status-belum">
                            <option value="BELUM" selected>BELUM</option>
                            <option value="HANTAR">HANTAR</option>
                        </select>
                    </td>
                </tr>`;
        });
    });

    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function closeModal() {
        document.getElementById('report-modal').style.display = 'none';
    }

    async function saveAndReset(tabId) {
        const overlay = document.getElementById('loading-overlay');
        const rows = document.querySelectorAll(`#tbody-${tabId} tr`);
        const filteredData = [];
        const hantarNames = [];

        rows.forEach(tr => {
            const status = tr.querySelector('select').value;
            if (status === "HANTAR") {
                const nama = tr.querySelector('.nama-cell').innerText;
                hantarNames.push(nama);
                filteredData.push({
                    nama: nama,
                    tarikh: tr.querySelector('input').value,
                    unit: tr.querySelector('.unit-cell').innerText,
                    nota: status
                });
            }
        });

        if (filteredData.length === 0) {
            alert("Tiada murid berstatus 'HANTAR'. Sila tanda sekurang-kurangnya satu.");
            return;
        }

        overlay.style.display = 'flex';

        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: JSON.stringify({ tab: tabId, data: filteredData })
            });

            // Sediakan Paparan Laporan
            const nameListDiv = document.getElementById('hantar-names');
            nameListDiv.innerHTML = "";
            hantarNames.forEach(n => {
                nameListDiv.innerHTML += `<div class="name-item"><i class="fa-solid fa-check-double"></i> ${n}</div>`;
            });
            document.getElementById('summary-text').innerText = `${filteredData.length} daripada ${senaraiNama.length} murid berjaya dikemaskini.`;

            // Reset Jadual
            rows.forEach(tr => {
                const selectEl = tr.querySelector('select');
                selectEl.value = "BELUM";
                selectEl.className = "status-belum";
                tr.querySelector('.unit-cell').innerText = "-";
            });

            setTimeout(() => {
                overlay.style.display = 'none';
                document.getElementById('report-modal').style.display = 'flex';
            }, 800);

        } catch (e) {
            overlay.style.display = 'none';
            alert("Ralat! Gagal menghantar data.");
        }
    }
</script>
</body>
</html>