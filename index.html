<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem RPM Bersepadu - Cikgu Suhaila</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-yellow: #fef9c3;
            --accent-yellow: #fbbf24;
            --black-deep: #121212;
            --black-soft: #1f1f1f;
            --white: #ffffff;
            --success: #059669;
            --danger: #dc2626;
            --text-muted: #6b7280;
            --border-color: #e5e7eb;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif; }

        body { background-color: var(--primary-yellow); color: var(--black-deep); min-height: 100vh; }

        /* Navigation */
        nav.top-bar {
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--black-deep);
            position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-weight: 800; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        .logo i { background: var(--accent-yellow); padding: 8px; border-radius: 10px; border: 1.5px solid var(--black-deep); }

        /* Main Dashboard (Menu Utama) */
        #dashboard-view { padding: 3rem 1rem; }
        .hero { text-align: center; margin-bottom: 3rem; }
        .hero h1 { font-size: 2.2rem; font-weight: 800; text-transform: uppercase; margin-bottom: 0.5rem; }
        .class-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; max-width: 1100px; margin: 0 auto; }
        .class-card { 
            background: var(--white); border: 2px solid var(--black-deep); border-radius: 28px; padding: 2.5rem; 
            text-align: center; cursor: pointer; box-shadow: 8px 8px 0px var(--black-deep); transition: 0.3s;
        }
        .class-card:hover { transform: translate(-5px, -5px); box-shadow: 12px 12px 0px var(--accent-yellow); }
        .icon-circle { width: 70px; height: 70px; background: var(--primary-yellow); border: 2px solid var(--black-deep); border-radius: 20px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; font-size: 1.8rem; }

        /* Classroom View (Borang Pengisian) */
        #class-view { display: none; padding-bottom: 50px; }
        .class-header { background: var(--black-deep); color: var(--white); padding: 2rem 1rem; text-align: center; border-bottom: 6px solid var(--accent-yellow); position: relative; }
        .btn-back { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); background: var(--accent-yellow); border: 2px solid var(--white); padding: 8px 15px; border-radius: 10px; font-weight: 800; cursor: pointer; font-size: 0.8rem; }
        
        .nav-tabs { display: flex; justify-content: center; gap: 5px; background: var(--white); padding: 0.8rem; border-bottom: 2px solid var(--black-deep); position: sticky; top: 65px; z-index: 900; }
        .tab-btn { padding: 0.7rem 1.2rem; border: none; background: transparent; cursor: pointer; font-weight: 700; font-size: 0.75rem; border-radius: 8px; }
        .tab-btn.active { background: var(--black-deep); color: var(--white); }

        .container { max-width: 1100px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: var(--white); padding: 1.5rem; border-radius: 20px; border: 2px solid var(--black-deep); box-shadow: 6px 6px 0px var(--black-deep); }
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
        .btn-save { background: var(--black-deep); color: var(--accent-yellow); border: none; padding: 12px 20px; border-radius: 10px; font-weight: 800; cursor: pointer; display: flex; align-items: center; gap: 8px; }

        /* Table Styles */
        .table-wrapper { overflow-x: auto; border-radius: 12px; border: 1px solid var(--black-deep); }
        table { width: 100%; border-collapse: collapse; }
        th { background: var(--primary-yellow); padding: 12px; text-align: left; font-size: 0.7rem; text-transform: uppercase; font-weight: 800; border-bottom: 2px solid var(--black-deep); }
        td { padding: 10px; border-bottom: 1px solid var(--border-color); font-size: 0.85rem; background: white; }
        .nama-cell { font-weight: 700; color: var(--black-deep); }
        input[type="date"], select { padding: 6px; border: 1px solid var(--black-deep); border-radius: 6px; font-weight: 600; font-size: 0.8rem; }
        .unit-cell { padding: 6px; border: 1px dashed var(--black-deep); border-radius: 6px; min-height: 30px; outline: none; background: #fffcf0; }
        
        select.status-hantar { background: #d1fae5; color: var(--success); border-color: var(--success); }
        select.status-belum { background: #fee2e2; color: var(--danger); border-color: var(--danger); }

        /* Overlay & Modals */
        #loading-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 2000; color: #fff; flex-direction: column; align-items: center; justify-content: center; }
        #report-modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 2001; padding: 20px; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 100%; max-width: 450px; border-radius: 24px; border: 3px solid var(--black-deep); padding: 2rem; box-shadow: 10px 10px 0px var(--black-deep); }
        .name-list { max-height: 200px; overflow-y: auto; margin: 15px 0; padding: 10px; background: var(--primary-yellow); border-radius: 10px; border: 1px solid var(--border-color); font-size: 0.8rem; font-weight: 600; }
    </style>
</head>
<body>

    <nav class="top-bar">
        <div class="logo"><i class="fa-solid fa-graduation-cap"></i> RPM BM TINGKATAN 2</div>
        <div style="font-weight: 700; font-size: 0.8rem;"><i class="fa-solid fa-user-circle"></i> CIKGU SUHAILA</div>
    </nav>

    <main id="dashboard-view">
        <section class="hero">
            <h1>Rekod Perkembangan Murid</h1>
            <p style="font-weight: 600; opacity: 0.7;">Sila pilih kelas untuk pengisian rekod pentaksiran</p>
        </section>

        <div class="class-grid">
            <div class="class-card" onclick="openClass('2 AD DARIMI')">
                <div class="icon-circle"><i class="fa-solid fa-book-open"></i></div>
                <h3>2 AD DARIMI</h3>
                <p style="font-size: 0.85rem; font-weight: 600; color: var(--text-muted);">33 Murid</p>
            </div>
            <div class="class-card" onclick="openClass('2 AL-GHAZALI')">
                <div class="icon-circle"><i class="fa-solid fa-pen-nib"></i></div>
                <h3>2 AL-GHAZALI</h3>
                <p style="font-size: 0.85rem; font-weight: 600; color: var(--text-muted);">34 Murid</p>
            </div>
            <div class="class-card" onclick="openClass('2 AL-IDRISI')">
                <div class="icon-circle"><i class="fa-solid fa-microscope"></i></div>
                <h3>2 AL-IDRISI</h3>
                <p style="font-size: 0.85rem; font-weight: 600; color: var(--text-muted);">34 Murid</p>
            </div>
        </div>
    </main>

    <main id="class-view">
        <header class="class-header">
            <button class="btn-back" onclick="closeClass()"><i class="fa-solid fa-arrow-left"></i> KEMBALI</button>
            <h1 id="current-class-title">KELAS</h1>
            <p>SESI PENTAKSIRAN 2026</p>
        </header>

        <nav class="nav-tabs">
            <button class="tab-btn active" onclick="switchTab('mendengar')">MENDENGAR</button>
            <button class="tab-btn" onclick="switchTab('membaca')">MEMBACA</button>
            <button class="tab-btn" onclick="switchTab('menulis')">MENULIS</button>
            <button class="tab-btn" onclick="switchTab('seni')">SENI BAHASA</button>
            <button class="tab-btn" onclick="switchTab('tatabahasa')">TATABAHASA</button>
        </nav>

        <div class="container">
            <div class="card">
                <div class="toolbar">
                    <h2 id="current-skill-title" style="font-size: 1rem; font-weight: 800;">KEMAHIRAN MENDENGAR</h2>
                    <button class="btn-save" onclick="submitData()">
                        <i class="fa-solid fa-cloud-upload-alt"></i> SIMPAN REKOD
                    </button>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th style="width: 40px; text-align: center;">Bil</th>
                                <th>Nama Murid</th>
                                <th style="width: 150px;">Tarikh</th>
                                <th style="width: 180px;">Unit/Topik</th>
                                <th style="width: 130px;">Status</th>
                            </tr>
                        </thead>
                        <tbody id="student-list"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <div id="loading-overlay">
        <i class="fa-solid fa-spinner fa-spin fa-3x"></i>
        <p style="margin-top: 15px; font-weight: 700;">Sedang menghantar data...</p>
    </div>

    <div id="report-modal">
        <div class="modal-content">
            <div style="text-align: center;">
                <i class="fa-solid fa-check-circle" style="font-size: 3rem; color: var(--success);"></i>
                <h3 style="margin-top: 10px;">DATA BERJAYA DISIMPAN!</h3>
            </div>
            <div class="name-list" id="success-names"></div>
            <button style="width: 100%; padding: 12px; background: var(--black-deep); color: white; border: none; border-radius: 10px; font-weight: 700; cursor: pointer;" onclick="document.getElementById('report-modal').style.display='none'">TUTUP</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwciq5ZXkKdCGF6bgMChyuWK2N-jBVdDO-snQl0wjFTy_Z2fPACUus1MrdCYkHBb-ponQ/exec";
        
        // Pangkalan Data Murid daripada fail-fail yang dimuat naik
        const database = {
            "2 AD DARIMI": ["ADAM MUHAMMAD ARIF BIN ABDUL HAKIM", "AHMAD AZIM MUTTAQIN BIN MOHD FAZIL", "AQIL HAIKAL BIN KHARUL AZLI", "ASHRAFF IZZQIEL BIN SAIPUL ANWAR NASUTION", "DIANA SHAFITRI BINTI AMIR", "MUHAIMIN FARIS ZAKIR BIN MOHD ZAIRI", "MUHAMMAD AATIF ZAYYAD BIN AMIRUDDIN", "MUHAMMAD ADAM ZAQUAN BIN MOHD SUKRI", "MUHAMMAD AIZUDDIN ADHA BIN AZMAN", "MUHAMMAD ASYRAFF SYAHIRAN BIN MOHD RIDUWAN", "MUHAMMAD AZRIN HAKEM BIN SUHAIMI", "MUHAMMAD NORHADI BIN NOOR MALHAFIZ", "MUHAMMAD SHAMSUL AMIRUL DANISH BIN MOHD SHAIFUL BAHRI", "MUHAMMAD UKASYAH ZARQASYI BIN AZIWA", "MUHAMMAD ZAFRAN QAYYIM BIN SUHAIRI", "NAJWA NAJEHA BINTI MUHAMMAD AMIRUL", "NOOR ARINA ADHWA BINTI NOAZMI", "NOR ALIYA NATASYA BINTI ABDUL MALIK", "NORFARZANA BINTI ABU BAKAR", "NUR AMIRAH BATRISYIA BINTI MOHD HAFIZAN", "NUR AULIA HAZIRA BINTI MOHD NORHASLAN", "NUR DAMIA QAISARA BINTI RAZZIS", "NUR DELISHA SAMEERA BINTI HASAN BASRI", "NUR HIDAYAH SOFIA BINTI AZMI", "NUR LIYANA SOFIA BINTI SAIFUL BAHARI", "NUR NADHIRAH BINTI MOHAMAD KHIR JOHARI", "NUR QHAIREEN AISYAH BINTI AL-MUSTAQIM BILLAH", "PUTERI ABABIL BT ABDULLAH", "PUTERI NURELESHA BINTI AZUWAN", "SITI NORFARISHA DANIA BINTI MUHAMMAD FIRDAUS", "ZARA IRDINA BINTI MOHD ASRULNIZAM", "ZULFAQAR BIN ZULKIFLI", "ZULFIQAR BIN ZULKIFLI"],
            "2 AL-GHAZALI": ["ABDUL AZIZ BIN MOHD NORHAN", "ANIS ALISA BINTI MOHAMAD RIDZUAN", "AWFIYAH NUR'BATRISYIA BINTI MOHD AMIRULLAH", "DHIA AMALIA BINTI ABDUL RAHMAN HO", "HANAN BINTI A'AMAR", "IZARA AINA BINTI ABDULLAH", "MASHALINDA BINTI MAHATHIR", "MOHAMAD FAHREZA SIDIK BIN ABDULLAH", "MOHAMAD IRFANHAFIZZY BIN MOHD YUSOFF", "MOHAMAD NOOR IZWAN ZAINUREEN BIN MOHD NORZAIHAN", "MUHAMAD HARITH DANISH BIN MUHAMAD ANWAR", "MUHAMAD RAYYAN FADHIL BIN ABDUL RAHMAN", "MUHAMMAD AFIF SHAKIRIN BIN MUHD AFNAN AIMAN", "MUHAMMAD AIDIL BIN HAMDI", "MUHAMMAD DANISH BIN MOHD NAZRI", "MUHAMMAD FAIRUZ FIRDAUS BIN MOHD FAIZAL", "MUHAMMAD ILMAN BIN IMAM RUYANI", "MUHAMMAD RAYYAN QAUSAR BIN MOHD ROZI", "MUHAMMAD RAYYAN RIZQI BIN MOHD FAIZAL", "MUHAMMAD SAIFUL HAFIZ BIN A.AZMAN", "MUHAMMAD SHAFIE DANIEL BIN MOHD SHAHRUL IQUAN", "NUR ADRIANA ALESYA BINTI MOHD FISOL", "NUR ALEESYA NADZIRA BINTI MOHD NADZRI", "NUR FATIN QAISARA BINTI ZULKIFLI", "NUR MALAIKA DAMIA BINTI GHAZALI", "NUR QASEH DAMIA BINTI MOHD ZAMRI", "NUR QASEH NASUHA BINTI MOHD RIZAN", "NUR ROHAIZATUL NAZMILA BINTI NOR ROLFAIZI", "NUR TRISHA LYDIANA BINTI RAMLI", "NUR ZULAIKHA BINTI MOHMAD APIZI", "NURSAHARA ZULAIKHA BINTI MASIRIN", "PUTRA IRFAN DANISH BIN MOHD RIZWAN", "PUTRIE QAISARA DAMIA BINTI IZWAN", "SYARIFAH NURFARHANA BINTI SYED ALFIAN"],
            "2 AL-IDRISI": ["ARESZ MIQAEL BIN MOHD SHAHARIZAM", "DHIA QISYA QAISARA BINTI ABDUL FATTAH", "FATEHA NURQISTINA BINTI RASHDANNIZAM", "GAJAENTHRAN A/L THANGARAJU", "IFFAH NOREZATI BINTI ZULKURNAIN", "KUSHAHMIR MIKHAIL BIN KUMUZAMIR", "LUTFIR RAHMAN BIN AMRAN", "MAGESVARY A/P MANIAM", "MUHAMAD DANISH HAIKAL BIN FAIZOO", "MUHAMAD SAFI'E BIN ABDULLAH", "MUHAMMAD ADAM IMRAN BIN MOHD KHAIROL NIZAM", "MUHAMMAD ADRIE DARWISY BIN MUHAMMED KAMARULZAMAN", "MUHAMMAD AL-ADHA BIN MOHD AZMAN", "MUHAMMAD AZRIF ZAFRIL BIN KHAIRISHAM", "MUHAMMAD DARWISY IMAN BIN ZULKIFLEE", "MUHAMMAD FAIZ AIDIL BIN MUHAMMAD FAKHRI", "MUHAMMAD RAYYAN NAUFAL BIN SHAIFUL SHAFIEE", "MUHAMMAD SAIFUL MUZAMIL BIN SAIFUL ZAMRI", "MUHAMMAD SAUFI RAYYAN BIN ABDULLAH", "MUHAMMAD ZIKRA ADYAN BIN ZAMAN NURI", "NIK NUR SYAMIMIE BATRISYA BINTI DARUS", "NOOR HAFIZAH AZ ZAHRA BINTI BASHARUDDIN", "NOR LIDIYA FITRI BINTI MOHD AZRAD", "NUR DELISHA MARISSA BINTI KIA KAMARUL AZIZI", "NUR FATIN IMANI BINTI MOHD AZIZI", "NUR INSYIRAH ZULAIKA BINTI MOHAMAD RIDUAN", "NUR SARFINA BINTI MOHD FIRDAUS", "NURHANA SUFIYYAH BINTI MOHD HANAFIAH", "NURIMANNI DAWAMA SUCHI BINTI NORSAHRUL ALSUWAT", "NURLAILA IRDINA BINTI MOHAMAD FADIL", "NURUL HAFIZIANA YAZLIN BINTI HAYAZI", "SYAFIQAH ATIRAH BINTI ZALI", "UMASRI A/P ELAMARAN", "UNGKU MUHAMMAD HAZRIQ BIN UNGKU ZULKARNAIN"]
        };

        let activeClass = "";
        let activeSkill = "mendengar";

        function openClass(className) {
            activeClass = className;
            document.getElementById('dashboard-view').style.display = 'none';
            document.getElementById('class-view').style.display = 'block';
            document.getElementById('current-class-title').innerText = className;
            renderStudents();
        }

        function closeClass() {
            document.getElementById('dashboard-view').style.display = 'block';
            document.getElementById('class-view').style.display = 'none';
        }

        function switchTab(skill) {
            activeSkill = skill;
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById('current-skill-title').innerText = "KEMAHIRAN " + skill.toUpperCase();
            renderStudents();
        }

        function renderStudents() {
            const list = document.getElementById('student-list');
            list.innerHTML = "";
            const students = database[activeClass];
            const today = new Date().toISOString().split('T')[0];

            students.forEach((nama, i) => {
                list.innerHTML += `
                    <tr>
                        <td style="text-align:center; font-weight:800;">${i+1}</td>
                        <td class="nama-cell">${nama}</td>
                        <td><input type="date" value="${today}"></td>
                        <td><div contenteditable="true" class="unit-cell">-</div></td>
                        <td>
                            <select class="status-belum" onchange="this.className='status-'+this.value.toLowerCase()">
                                <option value="BELUM">BELUM</option>
                                <option value="HANTAR">HANTAR</option>
                            </select>
                        </td>
                    </tr>`;
            });
        }

        async function submitData() {
            const rows = document.querySelectorAll("#student-list tr");
            const filteredData = [];
            const successNames = [];

            rows.forEach(tr => {
                const status = tr.querySelector('select').value;
                if(status === "HANTAR") {
                    const nama = tr.querySelector('.nama-cell').innerText;
                    successNames.push(nama);
                    filteredData.push({
                        nama: nama,
                        tarikh: tr.querySelector('input').value,
                        unit: tr.querySelector('.unit-cell').innerText,
                        nota: status
                    });
                }
            });

            if (filteredData.length === 0) {
                alert("Sila pilih sekurang-kurangnya satu murid berstatus 'HANTAR'.");
                return;
            }

            document.getElementById('loading-overlay').style.display = 'flex';

            try {
                // Nama tab di Google Sheets dihantar mengikut format: "Kelas_Kemahiran"
                const tabTarget = `${activeClass}_${activeSkill}`;
                
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ tab: tabTarget, data: filteredData })
                });

                document.getElementById('success-names').innerHTML = successNames.map(n => `<div><i class="fa-solid fa-check"></i> ${n}</div>`).join('');
                document.getElementById('report-modal').style.display = 'flex';
                
                // Reset table
                renderStudents();

            } catch (e) {
                alert("Ralat penghantaran data!");
            } finally {
                document.getElementById('loading-overlay').style.display = 'none';
            }
        }
    </script>
</body>
</html>